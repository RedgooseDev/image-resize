!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.ResizeImage=e()}(this,function(){"use strict";function t(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:320,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:240,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#ffffff";this.el=document.createElement("canvas"),this.ctx=this.el.getContext("2d"),this.el.width=t,this.el.height=e,this.ctx.fillStyle=n,this.ctx.fillRect(0,0,t,e)}function e(t){return new Promise(function(e,n){if(t){var o=new Image;o.onload=function(t){e(o)},o.onerror=function(t){n(t)},o.setAttribute("crossOrigin","anonymous"),o.src=t}else n(new Error("no src"))})}function n(e,n,o){return new Promise(function(r){function i(n,o){var a=Math.pow(2,n),c=new t(e.width*a,e.height*a,e.bgColor);c.ctx.drawImage(o.el,0,0,.5*o.el.width,.5*o.el.height),n>0?i(n-1,c):r(c)}i(n-1,o)})}function o(e){(e=Object.assign({},l,e)).reSample=Math.min(4,e.reSample),e.reSample=Math.max(0,e.reSample);var o=Math.pow(2,e.reSample);return new Promise(function(r,i){try{var a=new t(e.width*o,e.height*o,e.bgColor);a.ctx.drawImage(e.canvas.el,e.cx,e.cy,e.cw,e.ch,e.dx*o,e.dy*o,e.dw*o,e.dh*o),e.reSample>0?n(e,e.reSample,a).then(r):r(a)}catch(t){i(t)}})}function r(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/jpeg",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.75;return e=a(e),new Promise(function(o,r){try{o(t.toDataURL(e,n))}catch(t){r(t)}})}function i(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/jpeg",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.75;return e=a(e),new Promise(function(o,r){try{o(c(t.toDataURL(e,n)))}catch(t){r(t)}})}function a(t){var e=null;switch(t){case"jpg":case"jpeg":e="image/jpeg";break;case"png":e="image/png";break;default:e=t}return e}function c(t){for(var e=atob(t.split(",")[1]),n=t.split(",")[0].split(":")[1].split(";")[0],o=new ArrayBuffer(e.length),r=new Uint8Array(o),i=0;i<e.length;i++)r[i]=e.charCodeAt(i);var a=new DataView(o);return new Blob([a],{type:n})}function u(t,e,n,o){var r=t,i=e;return n&&o&&(n>o?o=null:n=null),n?(r=n,i=e*(n/t)):o&&(r=t*(o/e),i=o),{width:parseInt(r),height:parseInt(i)}}var h={quality:.75,format:"jpg",outputType:"base64",width:320,height:null,reSample:2,bgColor:"#ffffff",callback_ready:function(){console.log("READY PLAY")}},l={canvas:null,reSample:2,width:320,height:240,cx:0,cy:0,cw:0,ch:0,dx:0,dy:0,dw:0,dh:0,bgColor:"#ffffff"},f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(){function t(t){this.value=t}function e(e){function n(r,i){try{var a=e[r](i),c=a.value;c instanceof t?Promise.resolve(c.value).then(function(t){n("next",t)},function(t){n("throw",t)}):o(a.done?"return":"normal",a.value)}catch(t){o("throw",t)}}function o(t,e){switch(t){case"return":r.resolve({value:e,done:!0});break;case"throw":r.reject(e);break;default:r.resolve({value:e,done:!1})}(r=r.next)?n(r.key,r.arg):i=null}var r,i;this._invoke=function(t,e){return new Promise(function(o,a){var c={key:t,arg:e,resolve:o,reject:a,next:null};i?i=i.next=c:(r=i=c,n(t,e))})},"function"!=typeof e.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)}}();return function(n){function a(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={};return Object.keys(t).forEach(function(o){n[o]=e[o]||t[o]}),n.width=Number(n.width),n.height=Number(n.height),n.quality=Number(n.quality),n.reSample=Number(n.reSample),n}function c(n,o){var r=null;return new Promise(function(i,a){e(n).then(function(e){(r=new t(e.width,e.height,o.bgColor)).ctx.drawImage(e,0,0),i(r)},function(t){a(t)})})}function l(e,n){var o=null;return new Promise(function(r,i){function a(t){console.log("error event"),i(t)}var c=new FileReader;c.onload=function(e){var i=new Image;i.onload=function(){(o=new t(i.width,i.height,n.bgColor)).ctx.drawImage(i,0,0),r(o)},i.onerror=a,i.src=e.target.result},c.onerror=a,c.readAsDataURL(e.files[0])})}function s(t,e){return new Promise(function(n,r){var i=u(t.el.width,t.el.height,e.width,e.height);o({canvas:t,reSample:e.reSample,width:i.width,height:i.height,cx:0,cy:0,cw:t.el.width,ch:t.el.height,dx:0,dy:0,dw:i.width,dh:i.height,bgColor:e.bgColor}).then(n).catch(r)})}function d(t,e){return new Promise(function(n,o){switch(e.outputType){case"base64":r(t.el,e.format,e.quality).then(n).catch(o);break;case"blob":i(t.el,e.format,e.quality).then(n).catch(o);break;case"canvas":default:n(t.el)}})}this.options=a(h,n),this.play=function(t){var e=this;return this.options.callback_ready&&this.options.callback_ready(),new Promise(function(n,o){"string"==typeof t?c(t,e.options).then(function(t){return s(t,e.options)}).then(function(t){return d(t,e.options)}).then(function(t){return n(t)}).catch(function(t){return o(t)}):"object"===(void 0===t?"undefined":f(t))?l(t,e.options).then(function(t){return s(t,e.options)}).then(function(t){return d(t,e.options)}).then(function(t){return n(t)}).catch(function(t){return o(t)}):o(new Error("Not found source"))})},this.updateOptions=function(t){this.options=a(this.options,t)}}});
